image: node:latest

cache:
  paths:
    - node_modules/

stages:
  - deploy


deploy:
  stage: deploy
  before_script:
    - apt-get update -qq && apt-get install -y -qq sshpass
    - mkdir -p ~/.ssh
	- echo -e "$DEPLOY_KEY" > ~/.ssh/id_rsa
	- chmod 600 ~/.ssh/id_rsa
	- '[[ -f /.dockerenv ]] && echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config'

  script:
    - sshpass -V
    - export SSHPASS=$USER_PASS 
    - sshpass -e scp -o stricthostkeychecking=no -r . root@164.132.226.137:/var/www/juniorviec-web

  environment: staging
  only:
    - master
